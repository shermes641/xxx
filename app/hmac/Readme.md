## HMAC Signature
To authenticate server to server callbacks, we will be sending an HMAC signature in the request query string.

There is no requirement for the distributor to decode the HMAC signature, or include it in any requests to the Mediation server.

The sole purpose of adding the HMAC signature is to prove a request came from the Mediation server.

#### Generating an HMAC Signature

A signature is generated by calculating a digest using the HMAC-SHA256 hashing algorithm.
The inputs to the hashing algorithm include a shared secret and the body of the POST request.

        The shared secret will be created when an app is created ( apps table, hmac_secret column )
        Therefore each application will have it's own shared secret.
        If the distributor wants to validate the HMAC signature, he will need this value.
        The shared secret and callback URL are exposed on the "App Configuration" dialog

#### HMAC Signature Example

**Application callback URL**

        http://requestb.in/1fkadcg1?inspect

**With the following parameters:**

        Shared Secret:  83205a39-839f-48e9-9ad9-e5ef99956bb1

After calculating the HMAC signature, it is base64 encoded.

        digest = HMAC-SHA256 ( Shared Secret, prehashed_string )
        hmac = base64 ( digest )

### Testing

1. Get the App's shared secret from the App Configuration dialog.


2. Find your request at   http://requestb.in/1fkadcg1?inspect (you must set up your own request bin, just go to **http://requestb.in/** the **1fkadcg1** will change)

       FORM/POST PARAMETERS
       None

       QUERYSTRING
       hmac: UeuhuJ/iXLdsjekQGLRsjU5SfmGo8EIz4sqH4t34Xus=
       version: 1.0

       HEADERS
       Connection: close
       Connect-Time: 2
       Content-Length: 402
       Via: 1.1 vegur
       Host: requestb.in
       X-Request-Id: 77dd79b1-0349-46d0-819e-03f49b1b0bcd
       Content-Type: application/json; charset=utf-8
       User-Agent: NING/1.0
       Total-Route-Time: 0
       Accept: */*

       RAW BODY

       {"ad_provider":"ad provider name","estimated_offer_profit":null,"original_postback":"{\"ad_provider\":\"ad provider name\",\"estimated_offer_profit\":null,\"original_postback\":\"null\",\"reward_quantity\":1,\"time_stamp\":\"1464195989\",\"transaction_id\":\"transaction ID\",\"user_id\":\"user-id\"}","reward_quantity":1,"time_stamp":"1464195989","transaction_id":"transaction ID","user_id":"user-id"}

In paper trail find **Distributor hmac POST:** and copy the line below it, verify it exactly matches the RAW BODY string from the http://requestb.in/1fkadcg1?inspect web page

Example line to copy:

    {"ad_provider":"ad provider name","estimated_offer_profit":null,"original_postback":"{\"ad_provider\":\"ad provider name\",\"estimated_offer_profit\":null,\"original_postback\":\"null\",\"reward_quantity\":1,\"time_stamp\":\"1464195989\",\"transaction_id\":\"transaction ID\",\"user_id\":\"user-id\"}","reward_quantity":1,"time_stamp":"1464195989","transaction_id":"transaction ID","user_id":"user-id"}


Go to http://www.freeformatter.com/hmac-generator.html

Paste the line into the "Copy-paste the message here" text box
Copy your shared secret into the "Secret Key" text box (for our example the secret key is **some secret only for testing**)
Select "SHA256" in the "Select a message digest algorithm" list box
Click "COMPUTE HMAC"

Copy the text in the "Computed HMAC (in Hex):" text box
Goto http://tomeko.net/online_tools/hex_to_base64.php
Paste the text into the "Hex string:" text box, and click the Convert button
The text in the "Output (base64):" text box should match the hmac: value from the http://requestb.in/1fkadcg1?inspect QUERYSTRING section
