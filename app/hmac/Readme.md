## HMAC Signature
To authenticate server to server callbacks, we will be sending an HMAC signature in the request query string.

There is no requirement for the distributor to decode the HMAC signature, or include it in any requests to the Mediation server.

The sole purpose of adding the HMAC signature is to prove a request came from the Mediation server.

#### Generating an HMAC Signature

A signature is generated by calculating a digest using the HMAC-SHA256 hashing algorithm.
The inputs to the hashing algorithm include a shared secret and a normalized string that represents the current request.

        The shared secret will created when an app is created ( apps table, hmac_secret column )
        Therefore each application will have it's own shared secret.
        If the distributor wants to validate the HMAC signature, he will need this value.
        The shared secret is exposed on the "App Configuration" screen

To build the pre-hashed string concatenate the following elements separated by new line characters:

1. A timestamp value calculated for the request.
2. A nonce value generated for the request.

        This will be the transaction ID of the completion ( completions table, transaction_id column )

3. The request entity-body hash if one was calculated and included in the request, otherwise, an empty string.

        Currently this will always be an empty string

4. The HTTP request method in upper case: HEAD, GET, POST, PUT, or DELETE

5.  The path component of the HTTP request URI as defined by
       [RFC3986 section 3.3](http://tools.ietf.org/html/rfc3986#section-3.3)

6. The request port (typically 80 or 443)

7. The query component of the web service request URI as defined in [RFC3986 section 3.4](http://tools.ietf.org/html/rfc3986#section-3.4),
   and normalized as described in [HTTP MAC authentication scheme Section 3.3.1.1](http://tools.ietf.org/html/draft-hammer-oauth-v2-mac-token-02#section-3.3.1.1)

#### HMAC Signature Example

**When making a POST request to the following URL**

        https://some/distributor/server?inst=128807

**With the following parameters:**

        Shared Secret:  3ad19ddc-6ab7-47d0-bc7b-2df6e0bf8e35
        Timestamp:      145323506
        Nonce:          78319ddc-5a67-73g0-nj9b-9hs6e0bf7d3

**The pre-hashed string would look like the following:** ("" indicate empty string)


1.   145323506
2.   78319ddc-5a67-73g0-nj9b-9hs6e0bf7d3
3.   ""
4.   POST
5.   some/distributor/server
6.   443
7.   inst=128807
8.   ""

Note: Line numbers are there to illustrate that there is a new line character at the end.
      When making requests to URLs that have no query parameters, there should only be a single newline at the end of this pre-hashed string.

After calculating the HMAC signature, it is base64 encoded.

        digest = HMAC-SHA256 ( Shared Secret, prehashed_string )
        hmac = base64 ( digest )


This request would generate the following query string values. (spaces added for readability)

       ?timestamp="145323506"& nonce="78319ddc-5a67-73g0-nj9b-9hs6e0bf7d3"& hmac="5O6SRig58wqm6gqEu3oSODVte6Albon9CCvNrZHCoys="

