<div ng-hide="flashMessage.text() === ''" id="analytics-message" class="full-{{flashMessage.displayClass()}}-message">
    {{flashMessage.text()}}
</div>
<div id="analytics-controller">
    <div ng-include="subHeader"></div>
    <div id="email-modal" ng-show="showExportModal">
        <div class="close-button" ng-click="hideModal()"></div>
        <div id="csv-email-form" ng-show="showExportForm">
            <h1>Export Data</h1>
            <hr />
            <div class="modal-text">Enter the email address you would like to export all the data to.</div>
            <form name="exportForm" ng-submit="submit()" novalidate>
                <input type="email" ng-model="email" id="export-email" name="export_email" placeholder="Email Address" required />
                <div ng-show="exportForm.$submitted || exportForm.export_email.$touched">
                    <dd class="error" ng-show="exportForm.export_email.$error.required">Email address is required</dd>
                    <dd class="error" ng-show="exportForm.export_email.$error.email">The email you entered is invalid.</dd>
                </div>
                <input type="submit" class="modal-submit" id="export-submit" value="Export Data">
            </form>
        </div>
        <div id="csv-requested" ng-show="showExportComplete">
            <h1>Export Requested</h1>
            <hr />
            <div class="modal-text">Export has been requested, email will be sent once complete.</div>
            <button class="modal-submit" ng-click="hideModal()">Close</button>
        </div>
        <div id="csv-export-error" ng-show="showExportError">
            <h1>Export Error</h1>
            <hr />
            <div class="modal-text">There was an error when requesting the export, please try again.</div>
            <button id="export-requested-close" class="modal-submit" ng-click="hideModal()">Close</button>
        </div>
    </div>
    <div id="analytics-overlay" ng-click="hideModal()" ng-show="showExportModal"></div>
    <div id="left-content">
        <div class="left-apps-list">
            <h2>Date Range</h2>
            <ul>
                <div class="input-daterange input-group" id="datepicker">
                    <li class="arrowdown">
                        <input type="text" class="input-sm form-control" name="start" id="start-date" />
                    </li>
                    <li class="arrowdown">
                        <input type="text" class="input-sm form-control" name="end" id="end-date" />
                    </li>
                </div>
            </ul>
        </div>
        <div class="left-apps-list">
            <div class="reset-filters" ng-click="resetAllFilters()">Reset all Filters</div>
            <h2>Filter By Ad Provider</h2>
            <ul id="ad-providers-filter">
                <li ng-repeat="provider in filters.ad_providers.selected" ng-class="{removable: provider.id != 'all'}" class="active" ng-click="removeFromSelected('ad_providers', provider, $index)" title="{{provider.name}}">{{provider.name}}</li>
                <li class="add" ng-click="openDropdown('ad_providers')" ng-class="{open: filters.ad_providers.open}">
                    <span class="dropdown-label">Add Provider</span>
                    <input type="text" ng-model="filters.ad_providers.input" class="dropdown-filter input-sm form-control" name="filter-ad-providers" id="filter-ad_providers"
                           typeahead="name as ad_provider.name for ad_provider in filters.ad_providers.available | filter:$viewValue:emptyOrMatch | limitTo:8" typeahead-focus
                           typeahead-on-select="addToSelected('ad_providers', $item)"
                           ng-blur="closeDropdown('ad_providers')"/>
                </li>
            </ul>
        </div>
        <div class="left-apps-list">
            <h2>Filter By App</h2>
            <ul id="apps-filter">
                <li ng-repeat="appInfo in filters.apps.selected" ng-class="{removable: appInfo.id != 'all'}" class="active" ng-click="removeFromSelected('apps', appInfo, $index)" title="{{appInfo.name}}">
                    <img alt="" ng-hide="{{!appInfo.platformName}}" ng-src="{{platforms.logoSource(appInfo.platformName)}}" class="analytics-platform-logo">
                    <span ng-class="{'removable-app-filter': appInfo.name !== 'All Apps'}">
                        {{appInfo.name}}
                    </span>
                </li>
                <li class="add" ng-click="openDropdown('apps')" ng-class="{open: filters.apps.open}">
                    <span class="dropdown-label">Add App</span>
                    <input type="text" ng-model="filters.apps.input" class="dropdown-filter input-sm form-control" name="filter_apps" id="filter-apps"
                           typeahead="name as app.name for app in filters.apps.available | filter:$viewValue:emptyOrMatch | limitTo:8"
                           typeahead-focus
                           typeahead-on-select="addToSelected('apps', $item)"
                           typeahead-template-url="assets/templates/analytics/app-filter-dropdown.html"
                           ng-blur="closeDropdown('apps')"/>
                </li>
            </ul>
        </div>
        <div class="left-apps-list">
            <h2>Filter By Country</h2>
            <ul id="countries-filter">
                <li ng-repeat="country in filters.countries.selected" ng-class="{removable: country.id != 'all'}" class="active" ng-click="removeFromSelected('countries', country, $index)" title="{{country.name}}">{{country.name}}</li>
                <li class="add" ng-click="openDropdown('countries')" ng-class="{open: filters.countries.open}">
                    <span class="dropdown-label">Add Country</span>
                    <input type="text" ng-model="filters.countries.input" class="dropdown-filter input-sm form-control" name="filter-countries" id="filter-countries"
                           typeahead="name as country.name for country in filters.countries.available | filter:$viewValue:emptyOrMatch | limitTo:8" typeahead-focus
                           typeahead-on-select="addToSelected('countries', $item)"
                           ng-blur="closeDropdown('countries')"/>
                </li>
            </ul>
        </div>
        <button id="export-as-csv" ng-click="showExportModal = true">
            <div class="icon"></div>
            Export as CSV
        </button>
    </div>
    <div class="split-content dashboard" data-distributor-id="@distributorID">
        <div ng-show="analyticsTimeout" id="analytics-messaging" class="full-error-message">
            The analytics page is currently experiencing issues.  Please wait or try again later.
        </div>
        <div class="fluid-container">
            <div class="analytics-row analytics-row-header row">
                <div class="col-sm-12">
                    <h1 id="analytics-header" ng-class="{loaded: currentlyUpdating === false}">Analytics <span class="updating-status" ng-show="currentlyUpdating" id="analytics-loading-status">{{updatingStatus}}</span></h1>
                </div>
            </div>
            <div class="analytics-row row">
                <div class="col-sm-4 analytics-circle-border" id="ecpm-metric-container">
                    <div id="ecpm-metric" class="analytics-circle average-ecpm" ng-class="{loaded: analyticsData.ecpmMetric != null}">
                        <div ng-show="analyticsData.ecpmMetric != null" ng-bind-html="analyticsData.ecpmMetric"></div>
                        <div class="analytics-loading"><span class="square-1"></span><span class="square-2"></span><span class="square-3"></span></div>
                    </div>
                    <div class="analytics-description">
                        <div class="analytics-bullet average-ecpm"></div>
                        <b>Average eCPM</b>
                    </div>
                </div>

                <div class="col-sm-4 analytics-circle-border" id="fill-rate-container">
                    <div id="fill-rate" class="analytics-circle fill-rate" ng-class="{loaded: analyticsData.fillRateMetric != null}">
                        <div ng-show="analyticsData.fillRateMetric != null" ng-bind-html="analyticsData.fillRateMetric"></div>
                        <div class="analytics-loading"><span class="square-1"></span><span class="square-2"></span><span class="square-3"></span></div>
                    </div>
                    <div class="analytics-description">
                        <div class="analytics-bullet fill-rate"></div>
                        <b>Fill Rate</b>
                    </div>
                </div>

                <div class="col-sm-4" id="unique-users-container">
                    <div id="unique-users" class="analytics-circle revenue-by-day" ng-class="{loaded: analyticsData.revenueByDayMetric != null}">
                        <div ng-show="analyticsData.revenueByDayMetric != null" ng-bind-html="analyticsData.revenueByDayMetric"></div>
                        <div class="analytics-loading"><span class="square-1"></span><span class="square-2"></span><span class="square-3"></span></div>
                    </div>
                    <div class="analytics-description">
                        <div class="analytics-bullet revenue-by-day"></div>
                        <b>Average Revenue Per Day</b>
                    </div>
                </div>
            </div>

            <div class="analytics-row row">
                <div class="col-sm-12" id="estimated-revenue-chart-container">
                    <div ng-show="analyticsData.revenueChart" id="estimated-revenue-chart">
                    </div>
                    <div ng-show="!analyticsData.revenueChart" class="analytics-loading chart-loading"><span class="square-1"></span><span class="square-2"></span><span class="square-3"></span></div>
                    <div class="analytics-description">
                        <div class="analytics-bullet revenue-by-day"></div>
                        <b>Estimated Revenue</b><i>Above results use Ad Network eCPMs to estimate revenue.<br>All data is presented in UTC/GMT timezone.</i>
                    </div>
                </div>
            </div>

            <div class="analytics-row row">
                <div class="col-sm-12">
                    <table class="analytics-revenue-table" cellspacing="0" id="analytics-revenue-table">
                        <thead>
                            <tr>
                                <th>Date
                                    <div class="metric">Estimated Revenue</div>
                                    <div class="metric">eCPM</div>
                                    <div class="metric">Completions</div>
                                    <div class="metric">Impressions</div>
                                    <div class="metric">Fill Rate</div>
                                    <div class="metric">Requests</div>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="day in analyticsData.revenueTable">
                                <td>{{day.date}}
                                    <div class="metric">{{day.estimatedRevenue}}</div>
                                    <div class="metric">{{day.averageeCPM}}</div>
                                    <div class="metric">{{day.completedCount}}</div>
                                    <div class="metric">{{day.impressions}}</div>
                                    <div class="metric">{{day.fillRate}}</div>
                                    <div class="metric">{{day.requests}}</div>
                                </td>
                            </tr>
                            <tr ng-if="analyticsData.revenueTable.length == 0">
                                <td><div class="analytics-loading"><span class="square-1"></span><span class="square-2"></span><span class="square-3"></span></div></td>
                                <td></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>