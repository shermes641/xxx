<div ng-hide="flashMessage.text() === ''" id="waterfall-edit-message" class="full-{{flashMessage.displayClass()}}-message app-modal-message">
    {{flashMessage.text()}}
</div>
<div class="app-form">
    <form id="edit-app" name="form.editAppForm" ng-submit="submitEditApp(form.editAppForm)">
        <h1>App Configuration</h1>
        <div class="left-column">
            <dl id="app-name">
                <dt><label for="app-name">*App Name</label></dt>
                <dd ng-class="errors.appNameClass">
                    <input required type="text" ng-model="data.appName" clear-error-on-change="data.appName" form-name="form.editAppForm" id="appName" name="appName" value="" placeholder="name" label="*App Name">
                </dd>
                <div ng-show="form.editAppForm.$submitted || form.editAppForm.appName.$touched">
                    <dd id="edit-app-app-name-custom-error" class="error">{{errors.appName}}</dd>
                </div>
                <dd class="error" ng-show="form.editAppForm.appName.$error.required">App Name is required.</dd>
            </dl>

            <dl id="app-platform" class="device-targeting-field">
                <dt class="app-platform-display-label">
                    <label for="app-platform">Device Targeting</label>
                </dt>
                <dd>
                    <div id="edit-app-platform">
                        <div class="logo-background">
                            <img id="logo-background" alt="" src="/assets/images/grey_selected.png">
                        </div>
                        <div class="device-targeting-container">
                            <img class="device-targeting-icon" alt="" ng-src="{{platforms.logoSource(data.platformName)}}">
                        </div>
                    </div>
                </dd>
            </dl>

            <dl class="switch-field onoff-field" id="serverToServerEnabled-field">
                <dt>
                    <label for="serverToServerEnabled">Server to Server Callbacks Enabled</label>
                </dt>
                <dd>
                    <div class="onoffswitch switch-left">
                        <input type="checkbox" ng-model="data.serverToServerEnabled" id="serverToServerEnabled" name="serverToServerEnabled" value="true" class="onoffswitch-checkbox">
                        <label class="onoffswitch-label" for="serverToServerEnabled">
                            <span class="onoffswitch-inner"></span>
                            <span class="onoffswitch-switch"></span>
                        </label>
                        <span></span>
                    </div>
                </dd>
            </dl>

            <dl id="callback-url">
                <dt>
                    <label for="callback-url">
                        {{"Callback URL" | conditionalRequiredField: data.serverToServerEnabled}}
                    </label>
                    <h4 ng-mouseenter="hoverCallback=true" ng-mouseleave="hoverCallback=false" class="tooltip">
                        ?
                        <div id="callback-url-documentation-link" class="ngtooltip" ng-show="hoverCallback" ng-bind-html="'When a rewarded action is completed, our servers will make a POST request to a URL of your choosing, containing all the necessary reward information.  For more information, please see our <a href=\'https://documentation.hyprmx.com/display/ADMIN/Server+to+Server+Callbacks\' target=\'_blank\'>documentation</a>.' | escapeHtml"></div>
                    </h4>
                </dt>
                <dd ng-class="errors.callbackURLClass">
                    <input callback-validator="{{data.serverToServerEnabled}}" ng-disabled="!data.serverToServerEnabled" ng-class="{'inactive-input': !data.serverToServerEnabled}" type="text" ng-model="data.callbackURL" ng-model-options="{updateOn: 'blur'}" id="callbackURL" name="callbackURL" placeholder="callbackURL" label="Callback URL">
                </dd>
                <div ng-show="form.editAppForm.$submitted || form.editAppForm.callbackURL.$touched">
                    <dd class="error" ng-show="form.editAppForm.callbackURL.$error.callbackValidator" id="valid-callback-url-error">A valid HTTP or HTTPS callback URL is required.</dd>
                </div>
            </dl>

            <dl id="hmac-secret">
                <dt>
                    <label for="hmac-secret" class="ng-binding">
                        Shared Secret
                    </label>
                <h4 ng-mouseenter="hoverSecret=true" ng-mouseleave="hoverSecret=false" class="tooltip">
                    ?
                    <div id="hmac-secret-documentation-link" class="ngtooltip ng-binding ng-hide" ng-show="hoverSecret"
                         ng-bind-html="'If Server to Server Callbacks are Enabled, the Shared Secret is used to generate the query string for the POST to a URL of your choosing.
                            For more information, please see our <a href=\'https://documentation.hyprmx.com/display/ADMIN/Server+to+Server+Callbacks\' target=\'_blank\'>documentation</a>.' |
                         escapeHtml">If Server to Server Callbacks are Enabled, the Shared Secret is used to generate the query string for the POST to a URL of your choosing.
                            For more information, please see our <a href="https://documentation.hyprmx.com/display/ADMIN/Server+to+Server+Callbacks" target="_blank">documentation</a>.</div>
                </h4>
                </dt>
                <dd ng-class="errors.hmacSecretClass">
                    <input secret-validator="false" ng-readonly="true" ng-class="{'inactive-input': true}" type="text" ng-model="data.hmacSecret" ng-model-options="{updateOn: 'blur'}" id="hmacSecret" name="hmacSecret" placeholder="hmacSecret" label="Shared Secret" class="ng-pristine ng-untouched ng-valid inactive-input ng-valid-secret-validator" readonly="readonly">
                </dd>
            </dl>

            <dl id="currency-name">
                <dt><label for="currency-name">*Reward Name</label></dt>
                <dd ng-class="errors.currencyNameClass">
                    <input required type="text" ng-model="data.currencyName" id="currencyName" name="currencyName" placeholder="e.g. Gold or Silver" label="*Reward Name">
                    <div class="tip">Reward Name is the name of your in-app reward.</div>
                </dd>
                <dd class="error" ng-show="form.editAppForm.currencyName.$error.required">Reward Name is required.</dd>
            </dl>
        </div>
        <div class="right-column">

            <dl id="api-token-field">
                <dt><label for="api-token-field">API Token</label></dt>
                <dd>
                    <input type="text" ng-model="data.apiToken" class="inactive-input" id="api-token" name="apiToken" readonly="readonly">
                </dd>
            </dl>

            <dl id="exchange-rate">
                <dt><label for="exchange-rate">*Exchange Rate</label></dt>
                <dd ng-class="errors.exchangeRateClass">
                    <input required-integer type="text" ng-model="data.exchangeRate" ng-maxlength="15" label="*Exchange Rate" id="exchangeRate" name="exchangeRate" value="" placeholder="e.g. 100">
                    <div class="tip">The amount to reward per $1.</div>
                </dd>
                <dd class="error" ng-show="form.editAppForm.exchangeRate.$error.maxlength">Exchange Rate must be 15 characters or less.</dd>
                <dd class="error" ng-show="form.editAppForm.exchangeRate.$error.requiredInteger">Exchange Rate must be a valid integer greater than or equal to 1.</dd>
            </dl>

            <dl id="reward-min">
                <dt><label for="reward-min">*Minimum to Reward per Completed Offer</label></dt>
                <dd ng-class="errors.rewardMinClass">
                    <input required-integer type="text" ng-model="data.rewardMin" ng-maxlength="15" ng-change="form.editAppForm.rewardMax.$setTouched()" label="*Minimum Currency to Reward per Completed Offer" id="rewardMin" name="rewardMin" value="" placeholder="e.g. 1">
                </dd>
                <dd class="error" ng-show="form.editAppForm.rewardMin.$error.requiredInteger">Minimum Reward must be a valid integer greater than or equal to 1.</dd>
                <dd class="error" ng-show="form.editAppForm.rewardMin.$error.maxlength">Minimum Reward must be 15 characters or less.</dd>
            </dl>

            <dl id="reward-max">
                <dt><label for="reward-max">Maximum to Reward per Completed Offer</label></dt>
                <dd ng-class="errors.rewardMaxClass">
                    <input reward-max-validator greater-than-or-equal-to="{{data.rewardMin}}" type="text" ng-model="data.rewardMax" ng-maxlength="15" label="Maximum Currency to Reward per Completed Offer" id="rewardMax" name="rewardMax" value="" placeholder="e.g. 10">
                </dd>
                <dd class="error" ng-show="form.editAppForm.rewardMax.$error.rewardMaxValidator">Maximum Reward must be a valid integer greater than or equal to 1.</dd>
                <dd class="error" ng-show="form.editAppForm.rewardMax.$error.greaterThanOrEqualTo && !form.editAppForm.rewardMax.$error.rewardMaxValidator" id="reward-max-error">Maximum Reward must be greater than or equal to Minimum Reward.</dd>
                <dd class="error" ng-show="form.editAppForm.rewardMax.$error.maxlength">Maximum Reward must be 15 characters or less.</dd>
            </dl>

            <dl class="switch-field" id="roundUp-field">
                <dt>
                    <label for="roundUp">Round Up Reward</label>
                </dt>
                <dd>
                    <div class="onoffswitch switch-left">
                        <input type="checkbox" id="roundUp" name="roundUp" value="true" class="onoffswitch-checkbox" ng-model="data.roundUp"/>
                        <label class="onoffswitch-label" for="roundUp">
                            <span class="onoffswitch-inner"></span>
                            <span class="onoffswitch-switch"></span>
                        </label>
                        <span></span>
                    </div>
                </dd>
            </dl>
            <div>
                <label class="switch-checkbox-label">
                    Pay the user the Minimum Reward even if the eCPM isn't high enough. If not selected, networks with eCPM below the minimum will not show ads.
                </label>
            </div>
        </div>

        <input type="number" ng-model="data.currencyID" id="currencyID" name="currencyID" style="display: none">
        <input type="number" ng-model="data.generationNumber" id="generationNumber" name="generationNumber" style="display: none">

        <button id="update-app" ng-disabled="form.editAppForm.$invalid" type="submit" name="submit">Save Changes</button>
    </form>
</div>
